<html>
    <head>
        <META NAME="viewport" CONTENT="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
        <META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=UTF-8" />
        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
        <link href="css/matostyles.css" rel="old stylesheet" type="text/css" />
        <link href="css/style.css" rel="newer stylesheet" type="text/css" />
        <script type="text/javascript" src="js/luna.js" ></script>
        <script type="text/javascript" src="js/strict_utility.js" ></script>
        <script type="text/javascript" src="js/logic.js" ></script>
    <style>
            body {
                background-color: transparent;
                margin: 0px;
                color: gray;
            }

            #app_content {
                height: 100%;
                width: 100%;
            }

            .button-holder {
                width: 100%;
                position: absolute !important;
                bottom: 10px;
            }

            .camera-button {
                height: 60px;
                width: 60px;
                margin: auto;
                border-radius: 60px;
                color: #FAFAFA;
                z-index: 100;
            }
            .camera-button.shoot {
                background-color:gray;
            }
            .camera-button .fa{
                line-height: 60px;
                font-size: xx-large;
                left: 0px;
            }
        </style>
        <script>

            var filecounter = 1;
            (function(){
                var luna = new Luna();
                luna.addEventListener( "ready", function() {
                    var debug = utility.getElement(".debug", "SELECT");

                    luna.getNewAVCapture( { mode: [ "CAMERA" ], property:{opacity:0.1} } ).then( function( avcapture ) {

                        closeme.addEventListener("click", function(){
                            avcapture.stop();
                            luna.closeWebview( luna.getMainWebview() ).then(function(result){
                                luna.debug( "webview.closeWebview: " + result );
                            });
                        });

                        luna.getMainWebview().appendAVCapture({
                            avcapture   : avcapture,
                            isFixed     : true
                        }).then( function(result) {
                            avcapture.start();
                        });

                        document.getElementById("shoot").addEventListener("click", function(){
                            avcapture.capture().then(function( imageFile ){
                                
                                filecounter = new Date().getTime();

                                imageFile.getResizedDOM({quality:100}).then( function( DOM ){
                                    debug.appendChild( DOM );

                                    imageFile.move({
                                      to:  "stealthcam",
                                      isOverwrite: true
                                    }).then(function(url){
                                      luna.debug("file.copyFile: " + url)
                                      imageFile.rename({
                                        filename:  "image_" + filecounter + ".PNG"
                                      }).then(function(url){
                                        luna.debug( "luna.getFile: (new filename) " +  imageFile.getFilename());
                                      }, function(error){
                                        luna.debug("file.renameFile: " + error)
                                      })
                                    }, function(error){
                                      luna.debug("file.copyFile: " + error)
                                    });

                                }, function(error){
                                  luna.debug( "imageFile.getResizedDOM: " + error );
                                });

                                //THIS WONT WORK
                                // imageFile.move({
                                //   to:  "stealthcam",
                                //   isOverwrite: true
                                // }).then(function(url){
                                //   luna.debug("file.copyFile: " + url)
                                //   imageFile.rename({
                                //     filename:  "image_" + filecounter + ".PNG"
                                //   }).then(function(url){
                                //     luna.debug( "luna.getFile: (new filename) " +  imageFile.getFilename());
                                    
                                //     imageFile.getResizedDOM({quality:100}).then( function( DOM ){
                                //         debug.appendChild( DOM );
                                //     }, function(error){
                                //       luna.debug( "imageFile.getResizedDOM: " + error );
                                //     });

                                //   }, function(error){
                                //     luna.debug("file.renameFile: " + error)
                                //   })
                                // }, function(error){
                                //   luna.debug("file.copyFile: " + error)
                                // });


                            }, function(error){
                                luna.debug(error)
                            });
                        });

                    });

                });

             })();
        </script>
    </head>
    <body>
        <article id="app_content" class="matostyle">
            <div id="closeme">CLOSE</div>
            <div class="button-holder text-center">
                <div class="camera-button shoot" id="shoot">
                    <i class="fa fa-camera" aria-hidden="true"></i>
                </div>
            </div>

            <div class="debug"></div>

        </article>
    </body>
</html>

























